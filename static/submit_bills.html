<!DOCTYPE html>
<html>
<head>
    <title>上传支付账单</title>
    <!-- 引入Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <!-- 引入jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- 引入Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <style>
        /* Add a highlight effect to the active navigation item */
        .navbar-nav .active {
            color: #007bff;
            font-weight: bold;
        }

        /* Create a fullscreen overlay for the loading animation */
        #loading {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(255, 255, 255, 0.8) url('https://i.stack.imgur.com/FhHRx.gif') 50% 50% no-repeat;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">账单管理</a>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="#">导入</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" id="dashboard-link">看板</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container">
    <iframe id="dashboard-iframe" src="" width="100%" height="800" frameborder="0" style="display: none;"></iframe>
    <div id="main-content">
        <h1 class="mt-5 text-center">上传支付账单</h1>
        <form id="upload-form" class="mt-4">
            <div class="form-group">
                <label for="platform">平台</label>
                <select class="form-control" id="platform" name="platform">
                    <option value="weichat">微信</option>
                    <option value="alipay">支付宝</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">姓名</label>
                <select class="form-control" id="name" name="name">
                    <option>贾凯超</option>
                    <option>高宇</option>
                </select>
            </div>
            <div class="form-group">
                <label for="file">文件</label>
                <input type="file" class="form-control-file" id="file" name="file">
            </div>
            <button type="submit" class="btn btn-primary btn-block">提交</button>
        </form>
    </div>
</div>

<!-- Loading animation overlay -->
<div id="loading"></div>

<script>
    $(document).ready(function () {
        // Add an event listener to the navigation items
        $('.nav-item').on('click', function () {
            // Show the loading animation
            $('#loading').show();

            // Remove the 'active' class from the currently active item
            $('.nav-item.active').removeClass('active');

            // Add the 'active' class to the clicked item
            $(this).addClass('active');

            if (this.children[0].id === 'dashboard-link') {
                // If the dashboard link was clicked, show the dashboard iframe
                var dashboardUrl = 'http://192.168.31.250:3000/public-dashboards/560339bac6dc41a3ab2d67f0b2a37973';
                $('#dashboard-iframe').attr('src', dashboardUrl);
                $('#dashboard-iframe').show();
                $('#main-content').hide(); // hide main content when iframe is shown
            } else {
                // Otherwise, show the main content
                $('#dashboard-iframe').hide(); // hide iframe when main content is shown
                $('#main-content').show();
            }


            // Simulate a delay for loading the new page
            setTimeout(function () {
                // Hide the loading animation
                $('#loading').hide();
            }, 2000);
        });

        $('#upload-form').on('submit', function (e) {
            e.preventDefault();

            var formData = new FormData(this);
            var platform = $('#platform').val();
            var url = platform === 'weichat' ? 'http://127.0.0.1:8228/load_weichat_bills' : 'http://127.0.0.1:8228/load_alipay_bills';
            $.ajax({
                type: 'POST',
                url: url,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    alert('文件上传成功');
                },
                error: function (data) {
                    alert('文件上传出错');
                }
            });
        });
    });
</script>
</body>
</html>
